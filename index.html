<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ­å¤§é¸æ“‡æ¬Šæ•™å®¤ - éš¨å ‚æ¸¬é©—</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- ğŸŒŸ Firebase Modules -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // æ‚¨å°ˆå±¬çš„ Firebase è¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyCGt1XpGyvYCYqfyv2nijbdAyz1PmlLQMM",
            authDomain: "joption-question-bank.firebaseapp.com",
            projectId: "joption-question-bank",
            storageBucket: "joption-question-bank.firebasestorage.app",
            messagingSenderId: "821328038341",
            appId: "1:821328038341:web:8fdf2d0293d55ef323a3ac",
            measurementId: "G-PCF66C582B"
        };

        try {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);

            window.FirebaseSDK = { auth, db, signInAnonymously, doc, getDoc, setDoc, collection, getDocs };
            window.dispatchEvent(new Event('firebase-ready'));
        } catch (error) {
            console.error("Firebase åˆå§‹åŒ–å¤±æ•—:", error);
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@700;900&display=swap');
        body { background-color: #f4f4f2; font-family: 'Noto Serif TC', serif; margin: 0; padding: 0; min-height: 100vh; overflow-x: hidden; -webkit-overflow-scrolling: touch; }
        .certificate-outer { padding: 0; background: #ffffff; box-shadow: 0 40px 100px rgba(0,0,0,0.12); border-radius: 2px; width: 700px; height: 990px; margin: 0 auto; position: relative; box-sizing: border-box; display: block; flex-shrink: 0; }
        .certificate-container { background-color: #fdf8f1; background-image: repeating-linear-gradient(rgba(0,0,0,0.01) 0px, rgba(0,0,0,0.01) 1px, transparent 1px, transparent 3px), repeating-linear-gradient(90deg, rgba(0,0,0,0.01) 0px, rgba(0,0,0,0.01) 1px, transparent 1px, transparent 3px); border: 3.5px solid #a37b45; position: relative; overflow: hidden; width: 100%; height: 100%; box-sizing: border-box; }
        .watermark-overlay { position: absolute; inset: 0; z-index: 1; pointer-events: none; opacity: 0.04; background-image: url("data:image/svg+xml,%3Csvg width='160' height='80' viewBox='0 0 160 80' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='50%25' y='50%25' font-family='Arial, sans-serif' font-weight='900' font-size='12' fill='%23a37b45' text-anchor='middle' dominant-baseline='middle' transform='rotate(-25 80 40)'%3EJOPTION%3C/text%3E%3C/svg%3E"); background-repeat: repeat; }
        .certificate-inner-border { border: 1px solid #dcd0b9; margin: 14px; height: calc(100% - 28px); position: relative; z-index: 2; box-sizing: border-box; padding: 0; display: flex; flex-direction: column; align-items: center; }
        .no-wrap { white-space: nowrap; }
        .certificate-preview-scroll { width: 100%; display: flex; justify-content: center; overflow: hidden; }
        @media screen and (max-width: 768px) { .certificate-preview-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; align-items: flex-start; } .certificate-outer { transform: scale(0.45); transform-origin: top center; margin-bottom: -544.5px; } }
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 15px; backdrop-filter: blur(8px); animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .saveable-image { max-width: 100%; height: auto; display: block; user-select: auto !important; -webkit-user-select: auto !important; pointer-events: auto !important; }
        .scrollbar-hide::-webkit-scrollbar { display: none; } .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        .player-row { transition: transform 0.2s, box-shadow 0.2s; cursor: pointer; }
        .player-row:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- SVG åœ–ç¤ºå…ƒä»¶ ---
        const IconTrophy = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline mr-2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;
        const IconLock = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className="inline mr-1"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const IconHome = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline mr-2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
        const IconDownload = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>;
        const IconLoader = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`animate-spin ${className}`}><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/></svg>;
        const IconX = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
        const IconArrowDown = () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="inline ml-1"><path d="m6 9 6 6 6-6"/></svg>;
        const IconArrowUp = () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="inline ml-1"><path d="m18 15-6-6-6 6"/></svg>;
        const IconLogOut = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline mr-1 md:mr-2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>;
        const IconChevronLeft = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline mr-1"><path d="m15 18-6-6 6-6"/></svg>;

        const Ch1Icon = () => <svg className="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>;
        const Ch2Icon = () => <svg className="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
        const Ch3Icon = () => <svg className="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>;
        const Ch4Icon = () => <svg className="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" /></svg>;
        const Ch5Icon = () => <svg className="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" /></svg>;
        const Ch6Icon = () => <svg className="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>;
        const Ch7Icon = () => <svg className="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" /></svg>;

        // --- é›·é”åœ–å…ƒä»¶ ---
        const RadarChart = ({ scores }) => {
            const size = 300; 
            const center = size / 2;
            const radius = size / 2 - 45; 
            const numAxes = 7;
            const angleStep = (Math.PI * 2) / numAxes;

            const webLines = [];
            for (let level = 1; level <= 5; level++) {
                const r = radius * (level / 5);
                let points = [];
                for (let i = 0; i < numAxes; i++) {
                    const angle = i * angleStep - Math.PI / 2;
                    points.push(`${center + r * Math.cos(angle)},${center + r * Math.sin(angle)}`);
                }
                webLines.push(<polygon key={level} points={points.join(' ')} fill="none" stroke="#e5e7eb" strokeWidth="1" />);
            }

            const axesLines = [];
            const labels = [];
            for (let i = 0; i < numAxes; i++) {
                const angle = i * angleStep - Math.PI / 2;
                const x = center + radius * Math.cos(angle);
                const y = center + radius * Math.sin(angle);
                axesLines.push(<line key={`axis-${i}`} x1={center} y1={center} x2={x} y2={y} stroke="#e5e7eb" strokeWidth="1" />);
                
                const labelX = center + (radius + 32) * Math.cos(angle);
                const labelY = center + (radius + 32) * Math.sin(angle);
                
                labels.push(
                    <text key={`label-${i}`} x={labelX} y={labelY} textAnchor="middle" dominantBaseline="middle" className="font-sans font-black tracking-wider" fontSize="18" fill="#4f46e5">
                        CH{i + 1}
                    </text>
                );
            }

            const dataPoints = [1, 2, 3, 4, 5, 6, 7].map((ch, i) => {
                const score = scores[ch] || 0;
                const r = radius * (score / 100);
                const angle = i * angleStep - Math.PI / 2;
                return `${center + r * Math.cos(angle)},${center + r * Math.sin(angle)}`;
            }).join(' ');

            const dataDots = [1, 2, 3, 4, 5, 6, 7].map((ch, i) => {
                const score = scores[ch] || 0;
                const r = radius * (score / 100);
                const angle = i * angleStep - Math.PI / 2;
                return <circle key={`dot-${i}`} cx={center + r * Math.cos(angle)} cy={center + r * Math.sin(angle)} r="4" fill="#4f46e5" stroke="#ffffff" strokeWidth="2" />;
            });

            return (
                <svg width="100%" height="100%" viewBox={`0 0 ${size} ${size}`} className="overflow-visible mx-auto drop-shadow-sm">
                    {webLines}
                    {axesLines}
                    <polygon points={dataPoints} fill="rgba(99, 102, 241, 0.2)" stroke="#4f46e5" strokeWidth="2" strokeLinejoin="round" />
                    {dataDots}
                </svg>
            );
        };

        function App() {
            const [view, setView] = useState('auth'); 
            const [isLoadingApp, setIsLoadingApp] = useState(true);
            const [isLoadingProgress, setIsLoadingProgress] = useState(false);
            
            const [isFirebaseReady, setIsFirebaseReady] = useState(false);
            
            const [playerName, setPlayerName] = useState('');
            const [playerEmail, setPlayerEmail] = useState('');
            const [chapterScores, setChapterScores] = useState({ 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0 });
            
            const [currentChapterIndex, setCurrentChapterIndex] = useState(1);
            const [currentQuestions, setCurrentQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [failedThisQuestion, setFailedThisQuestion] = useState(false);
            const [quizFeedback, setQuizFeedback] = useState('');
            const [feedbackKey, setFeedbackKey] = useState(0); 

            const [authError, setAuthError] = useState('');
            const [leaderboard, setLeaderboard] = useState([]);
            const [isLoadingLeaderboard, setIsLoadingLeaderboard] = useState(false);
            const [sortConfig, setSortConfig] = useState({ field: 'average', direction: 'desc' });
            
            const [selectedUser, setSelectedUser] = useState(null);

            const [isSaving, setIsSaving] = useState(false);
            const [savedImageUrl, setSavedImageUrl] = useState(null);

            const certificateRef = useRef(null);

            const CHAPTERS = [
                { id: 1, title: "CH 1 é¸æ“‡æ¬Šå…¥é–€", short: "å…¥é–€", level: "Beginner", icon: <Ch1Icon /> },
                { id: 2, title: "CH 2 åŸºç¤çŸ¥è­˜", short: "åŸºç¤", level: "Basic", icon: <Ch2Icon /> },
                { id: 3, title: "CH 3 æ¬Šåˆ©é‡‘çš„ç§˜å¯†", short: "ç§˜å¯†", level: "Strategy", icon: <Ch3Icon /> },
                { id: 4, title: "CH 4 å¸Œè‡˜å­—æ¯å¯¦æˆ°åŠ›", short: "å¸Œè‡˜", level: "Intermediate", icon: <Ch4Icon /> },
                { id: 5, title: "CH 5 é¸æ“‡æ¬Šçš„ä¹ä¹ä¹˜æ³•è¡¨", short: "ä¹ä¹", level: "Advanced", icon: <Ch5Icon /> },
                { id: 6, title: "CH 6 å¸¸è¦‹å•é¡Œé›†", short: "å•é¡Œ", level: "Expert", icon: <Ch6Icon /> },
                { id: 7, title: "é€²éšï¼šJoption é‡åŒ–äº¤æ˜“", short: "é‡åŒ–", level: "Pro", icon: <Ch7Icon /> },
            ];

            // ğŸŒŸ å®Œæ•´å…§å»ºé¡Œåº« (ç„¡é ˆè®€å–å¤–éƒ¨ JSON)
            const ALL_QUESTIONS = {
                1: [
                    { q: "é¸æ“‡æ¬Šæœ€æ ¸å¿ƒçš„å®šç¾©æ˜¯ä»€éº¼ï¼Ÿ", a: ["ä¸€ç¨®åœ¨æœªä¾†ä»¥ç‰¹å®šåƒ¹æ ¼è²·è³£æ¨™çš„ç‰©çš„æ¬Šåˆ©", "ä¸€ç¨®ä¿è­‰ç²åˆ©çš„æŠ•è³‡å·¥å…·", "ä¸€ç¨®æ²’æœ‰åˆ°æœŸæ—¥çš„è‚¡ç¥¨", "ä¸€ç¨®åªèƒ½çœ‹æ¼²çš„æœŸè²¨"], correct: 0 },
                    { q: "é—œæ–¼é¸æ“‡æ¬Šè²·æ–¹çš„æ•˜è¿°ï¼Œä½•è€…æ­£ç¢ºï¼Ÿ", a: ["æ”¶å–æ¬Šåˆ©é‡‘ï¼Œæ‰¿æ“”ç¾©å‹™", "æ”¯ä»˜æ¬Šåˆ©é‡‘ï¼Œå–å¾—æ¬Šåˆ©", "ç„¡é ˆæ”¯ä»˜ä»»ä½•è²»ç”¨", "ç²åˆ©ç©ºé–“æœ‰é™"], correct: 1 },
                    { q: "é—œæ–¼é¸æ“‡æ¬Šè³£æ–¹çš„æ•˜è¿°ï¼Œä½•è€…æ­£ç¢ºï¼Ÿ", a: ["æ”¯ä»˜æ¬Šåˆ©é‡‘ï¼Œå–å¾—æ¬Šåˆ©", "æ”¶å–æ¬Šåˆ©é‡‘ï¼Œæ‰¿æ“”ç¾©å‹™", "é¢¨éšªçµ•å°æœ‰é™", "ä¸éœ€è¦ä¿è­‰é‡‘"], correct: 1 },
                    { q: "åœ¨é¸æ“‡æ¬Šå¸‚å ´ä¸­ï¼Œæ¬Šåˆ©èˆ‡ç¾©å‹™çš„å°ç¨±æ€§æ˜¯æŒ‡ï¼Ÿ", a: ["é›™æ–¹çš†æœ‰ç¾©å‹™", "é›™æ–¹çš†æœ‰æ¬Šåˆ©", "è²·æ–¹æœ‰æ¬Šåˆ©ç„¡ç¾©å‹™ï¼Œè³£æ–¹æœ‰ç¾©å‹™ç„¡æ¬Šåˆ©", "é›™æ–¹çš†ç„¡ç¾©å‹™"], correct: 2 },
                    { q: "ç†è«–ä¸Šï¼Œé¸æ“‡æ¬Šã€Œè³£æ–¹ã€çš„ç²åˆ©æ©Ÿç‡èˆ‡ã€Œè²·æ–¹ã€ç›¸æ¯”é€šå¸¸å¦‚ä½•ï¼Ÿ", a: ["è²·æ–¹å‹ç‡è¼ƒé«˜", "å…©è€…å‹ç‡ä¸€æ¨£", "è³£æ–¹å‹ç‡è¼ƒé«˜ï¼Œä½†æ‰¿æ“”ç„¡é™é¢¨éšª", "è³£æ–¹å‹ç‡è¼ƒä½"], correct: 2 },
                    { q: "é¸æ“‡æ¬Šè²·æ–¹æœ€å¤§çš„é¢¨éšªæ˜¯ä»€éº¼ï¼Ÿ", a: ["è¢«è¦æ±‚ç„¡é™è¿½åŠ ä¿è­‰é‡‘", "æå¤±æ‰€æœ‰æ”¯ä»˜çš„æ¬Šåˆ©é‡‘", "å¿…é ˆå¼·åˆ¶è²·å…¥è‚¡ç¥¨", "é•ç´„è¢«ç½°æ¬¾"], correct: 1 },
                    { q: "ç•¶ä½ æ¥µåº¦çœ‹å¥½å¾Œå¸‚å¤§æ¼²ï¼Œæœ€åŸºæœ¬çš„æ“ä½œæ˜¯ï¼Ÿ", a: ["è²·é€²è³£æ¬Š (Long Put)", "è³£å‡ºè²·æ¬Š (Short Call)", "è²·é€²è²·æ¬Š (Long Call)", "è³£å‡ºè³£æ¬Š (Short Put)"], correct: 2 },
                    { q: "åœ¨é¸æ“‡æ¬Šä¸­ï¼Œã€Œè²·æ¬Š(Call)ã€è³¦äºˆè²·æ–¹çš„æ¬Šåˆ©æ˜¯ï¼Ÿ", a: ["ä»¥ç‰¹å®šåƒ¹æ ¼è³£å‡ºæ¨™çš„", "ä»¥ç‰¹å®šåƒ¹æ ¼è²·å…¥æ¨™çš„", "è³ºå–æ‰€æœ‰æ¬Šåˆ©é‡‘", "å€Ÿå…¥è³‡é‡‘"], correct: 1 },
                    { q: "ã€Œè³£æ¬Š(Put)ã€è³¦äºˆè²·æ–¹çš„æ¬Šåˆ©æ˜¯ï¼Ÿ", a: ["ä»¥ç‰¹å®šåƒ¹æ ¼è³£å‡ºæ¨™çš„", "ä»¥ç‰¹å®šåƒ¹æ ¼è²·å…¥æ¨™çš„", "ç„¡æ¢ä»¶å–æ¶ˆäº¤æ˜“", "ç²å¾—å›ºå®šåˆ©æ¯"], correct: 0 },
                    { q: "ç•¶è²·æ–¹æ”¾æ£„å±¥ç´„æ™‚ï¼Œè³£æ–¹æœ‰ä»€éº¼æ¬Šåˆ©ï¼Ÿ", a: ["è¢«å¼·åˆ¶å¹³å€‰", "é€€é‚„éƒ¨åˆ†æ¬Šåˆ©é‡‘", "ä¿ç•™å·²æ”¶å–çš„æ‰€æœ‰æ¬Šåˆ©é‡‘", "é­å—ç½°æ¬¾"], correct: 2 }
                ],
                2: [
                    { q: "ä»€éº¼æ˜¯ã€Œå±¥ç´„åƒ¹ã€ï¼Ÿ", a: ["é¸æ“‡æ¬Šæ›ç‰Œçš„åƒ¹æ ¼", "è²·è³£é›™æ–¹ç´„å®šæœªä¾†äº¤æ˜“æ¨™çš„ç‰©çš„åƒ¹æ ¼", "ç›®å‰çš„å¸‚å ´æŒ‡æ•¸", "æ¬Šåˆ©é‡‘çš„æœ€é«˜åƒ¹"], correct: 1 },
                    { q: "ä»€éº¼æ˜¯ã€Œåƒ¹å…§(ITM)ã€é¸æ“‡æ¬Šï¼Ÿ", a: ["åˆ°æœŸæ™‚æ¯«ç„¡åƒ¹å€¼çš„é¸æ“‡æ¬Š", "å…·æœ‰å…§æ¶µåƒ¹å€¼çš„é¸æ“‡æ¬Š", "å±¥ç´„åƒ¹ç­‰æ–¼ç¾åƒ¹", "åªæœ‰æ™‚é–“åƒ¹å€¼çš„é¸æ“‡æ¬Š"], correct: 1 },
                    { q: "ä»€éº¼æ˜¯ã€Œåƒ¹å¤–(OTM)ã€é¸æ“‡æ¬Šï¼Ÿ", a: ["ä¸å…·å…§æ¶µåƒ¹å€¼ï¼Œåˆ°æœŸæ™‚åƒ¹å€¼æ­¸é›¶", "å±¥ç´„åƒ¹é ä½æ–¼ç¾åƒ¹çš„è²·æ¬Š", "å…·æœ‰æœ€å¤§å…§æ¶µåƒ¹å€¼", "å‹ç‡æœ€é«˜çš„é¸æ“‡æ¬Š"], correct: 0 },
                    { q: "é¸æ“‡æ¬Šçš„ã€Œæ¬Šåˆ©é‡‘ã€æ˜¯æŒ‡ï¼Ÿ", a: ["æœŸè²¨å•†æ”¶çš„æ‰‹çºŒè²»", "çµç®—æ™‚çš„åƒ¹å·®", "è²·æ–¹æ”¯ä»˜çµ¦è³£æ–¹ä»¥å–å¾—é¸æ“‡æ¬Šçš„åƒ¹æ ¼", "è³£æ–¹å¿…é ˆå­˜æ”¾çš„æ“”ä¿é‡‘"], correct: 2 },
                    { q: "å°æŒ‡é¸æ“‡æ¬Šä¸­ï¼Œæ‰€è¬‚çš„ã€Œé€±é¸æ“‡æ¬Šã€é€šå¸¸åœ¨æ¯é€±å¹¾é€²è¡Œçµç®—ï¼Ÿ", a: ["é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››"], correct: 2 },
                    { q: "è³£æ–¹åœ¨é–‹å€‰æ™‚ï¼Œå¿…é ˆç¹³äº¤ä»€éº¼ä»¥ç¢ºä¿å…¶å±¥ç´„èƒ½åŠ›ï¼Ÿ", a: ["åˆ©æ¯", "æ¬Šåˆ©é‡‘", "ä¿è­‰é‡‘", "æ‰€å¾—ç¨…"], correct: 2 },
                    { q: "è¶Šæ¥è¿‘çµç®—æ—¥ï¼Œåƒ¹å¤–é¸æ“‡æ¬Šçš„æ¬Šåˆ©é‡‘æœƒç™¼ç”Ÿä»€éº¼è®ŠåŒ–ï¼ˆåˆ°æœŸæ•ˆæ‡‰ï¼‰ï¼Ÿ", a: ["åŠ é€Ÿæ­¸é›¶", "ç¶­æŒä¸è®Š", "å‘ˆå€æ•¸å¢é•·", "éš¨æ©Ÿè·³å‹•"], correct: 0 },
                    { q: "çµç®—æ—¥ç•¶å¤©ï¼Œæ‰€æœ‰åƒ¹å¤–é¸æ“‡æ¬Šçš„æœ€çµ‚åƒ¹å€¼ç‚ºï¼Ÿ", "a": ["ç­‰æ–¼å±¥ç´„åƒ¹", "0", "ç­‰æ–¼å…§æ¶µåƒ¹å€¼", "100"], correct: 1 },
                    { q: "ç•¶é¸æ“‡æ¬Šå±¥ç´„åƒ¹æ­£å¥½ç­‰æ–¼æ¨™çš„ç¾åƒ¹æ™‚ï¼Œç¨±ç‚ºï¼Ÿ", "a": ["åƒ¹å…§ ITM", "åƒ¹å¤– OTM", "åƒ¹å¹³ ATM", "æ·±åƒ¹å…§"], correct: 2 },
                    { q: "é¸æ“‡æ¬Šè³£æ–¹æ”¶å–çš„æ¬Šåˆ©é‡‘ä½•æ™‚æœƒçœŸæ­£æˆç‚ºç¢ºå®šç²åˆ©ï¼Ÿ", "a": ["éƒ¨ä½å¹³å€‰æˆ–åˆ°æœŸç„¡åƒ¹å€¼æ™‚", "å‰›è³£å‡ºçš„ç¬é–“", "å¸‚å ´å¤§è·Œæ™‚", "è²·æ–¹é€²å ´æ™‚"], correct: 0 }
                ],
                3: [
                    { q: "æ¬Šåˆ©é‡‘çš„çµ„æˆå…¬å¼ç‚ºä½•ï¼Ÿ", a: ["æœ¬é‡‘ + åˆ©æ¯", "å…§æ¶µåƒ¹å€¼ + æ™‚é–“åƒ¹å€¼", "ä¿è­‰é‡‘ + æ‰‹çºŒè²»", "ç¾åƒ¹ + æº¢åƒ¹"], correct: 1 },
                    { q: "å°æ–¼ã€Œåƒ¹å¤–ã€é¸æ“‡æ¬Šï¼Œå…¶æ¬Šåˆ©é‡‘å®Œå…¨ç”±ä»€éº¼çµ„æˆï¼Ÿ", "a": ["å…§æ¶µåƒ¹å€¼", "æ‰‹çºŒè²»", "æ™‚é–“åƒ¹å€¼", "çµç®—åƒ¹"], correct: 2 },
                    { q: "æ™‚é–“åƒ¹å€¼çš„æµé€(Theta)å°å“ªä¸€æ–¹æœ€æœ‰åˆ©ï¼Ÿ", "a": ["è²·æ–¹", "è³£æ–¹", "é›™æ–¹çš†æœ‰åˆ©", "ç„¡é—œç·Šè¦"], correct: 1 },
                    { q: "é¸æ“‡æ¬Šçš„æ™‚é–“åƒ¹å€¼æµé€è¦å¾‹é€šå¸¸æ˜¯ï¼Ÿ", "a": ["å‘ˆç­‰é€Ÿç›´ç·šä¸‹é™", "è¶Šæ¥è¿‘åˆ°æœŸæ—¥ï¼Œæµé€é€Ÿåº¦è¶Šå¿«", "è¶Šæ¥è¿‘åˆ°æœŸæ—¥ï¼Œæµé€è¶Šæ…¢", "å®Œå…¨ä¸æœƒæµé€"], correct: 1 },
                    { q: "è‹¥å°æŒ‡æœŸç›®å‰ç‚º15000é»ï¼Œå±¥ç´„åƒ¹14800çš„è²·æ¬Š(Call)å…¶å…§æ¶µåƒ¹å€¼ç‚ºä½•ï¼Ÿ", "a": ["0é»", "100é»", "200é»", "500é»"], correct: 2 },
                    { q: "ä»€éº¼ç‹€æ…‹çš„é¸æ“‡æ¬Šï¼Œå…¶æ™‚é–“åƒ¹å€¼æœƒæœ€å¤§ï¼Ÿ", "a": ["æ·±åº¦åƒ¹å…§", "æ·±åº¦åƒ¹å¤–", "åƒ¹å¹³ (ATM) é™„è¿‘", "å·²ç¶“åˆ°æœŸ"], correct: 2 },
                    { q: "è²·æ–¹åœ¨é¢å°æ™‚é–“åƒ¹å€¼æµé€æ™‚ï¼Œæœ€å¤§çš„éš±å½¢æˆæœ¬æ˜¯ä»€éº¼ï¼Ÿ", "a": ["è¦è£œç¹³ä¿è­‰é‡‘", "å³ä½¿æ–¹å‘çœ‹å°ï¼Œè‹¥æ¼²å¹…ä¸å¤ ä»å¯èƒ½è™§æ", "åˆ¸å•†æ‰‹çºŒè²»è®Šè²´", "æœƒè¢«å¼·åˆ¶å¹³å€‰"], correct: 1 },
                    { q: "æ·±åº¦åƒ¹å…§çš„é¸æ“‡æ¬Šï¼Œå…¶æ¬Šåˆ©é‡‘ä¸»è¦ç”±ä»€éº¼æ§‹æˆï¼Ÿ", "a": ["å…§æ¶µåƒ¹å€¼ç‚ºä¸»", "æ™‚é–“åƒ¹å€¼ç‚ºä¸»", "åªæœ‰æ‰‹çºŒè²»", "ä¿è­‰é‡‘"], correct: 0 },
                    { q: "éš¨è‘—å¸‚å ´éš±å«æ³¢å‹•ç‡ä¸‹é™ï¼Œæ™‚é–“åƒ¹å€¼é€šå¸¸æœƒå¦‚ä½•è®ŠåŒ–ï¼Ÿ", "a": ["è®Šå¤§", "è®Šå°", "ä¸è®Š", "è®Šç‚ºè² æ•¸"], correct: 1 },
                    { q: "ç‚ºä»€éº¼è²·æ–¹ä¸å®œé•·æœŸæŒæœ‰æ·±åº¦åƒ¹å¤–çš„é¸æ“‡æ¬Šï¼Ÿ", "a": ["å› ç‚ºä¿è­‰é‡‘å¾ˆé«˜", "å› ç‚ºæ²’æœ‰å…§æ¶µåƒ¹å€¼ï¼Œä¸”æ™‚é–“åƒ¹å€¼æœƒåŠ é€Ÿæ­¸é›¶", "å› ç‚ºè³£æ–¹æœƒå¼·åˆ¶å›æ”¶", "å› ç‚ºçµç®—åƒ¹æœƒæ‰£ç¨…"], correct: 1 }
                ],
                4: [
                    { q: "å¸Œè‡˜å­—æ¯ Delta çš„ä¸»è¦æ„ç¾©æ˜¯è¡¡é‡ä»€éº¼å°æ¬Šåˆ©é‡‘çš„å½±éŸ¿ï¼Ÿ", "a": ["æ™‚é–“è®ŠåŒ–", "æ¨™çš„åƒ¹æ ¼è®Šå‹•", "æ³¢å‹•ç‡è®ŠåŒ–", "åˆ©ç‡è®ŠåŒ–"], correct: 1 },
                    { q: "è²·é€²è²·æ¬Š (Long Call) çš„ Delta å€¼ç¯„åœå¤§ç´„è½åœ¨ï¼Ÿ", "a": ["-1 åˆ° 0 ä¹‹é–“", "0 åˆ° 1 ä¹‹é–“", "1 åˆ° 2 ä¹‹é–“", "ç„¡é™åˆ¶"], correct: 1 },
                    { q: "å¸Œè‡˜å­—æ¯ Gamma è¡¡é‡çš„æ˜¯ä»€éº¼ï¼Ÿ", "a": ["Delta å€¼è®Šå‹•çš„åŠ é€Ÿåº¦", "æ™‚é–“è¡°æ¸›çš„é€Ÿåº¦", "æ³¢å‹•ç‡çš„å¤§å°", "ä¿è­‰é‡‘çš„éœ€æ±‚"], correct: 0 },
                    { q: "å°æ–¼é¸æ“‡æ¬Šè³£æ–¹è€Œè¨€ï¼ŒTheta çš„æ•¸å€¼é€šå¸¸æ˜¯æ­£é‚„æ˜¯è² ï¼Ÿ", "a": ["è² å€¼", "æ­£å€¼ï¼Œä»£è¡¨æ™‚é–“ç¶“éæœƒå¢åŠ ç²åˆ©", "é›¶", "è¦–æ³¢å‹•ç‡è€Œå®š"], correct: 1 },
                    { q: "å¸Œè‡˜å­—æ¯ Vega ä»£è¡¨é¸æ“‡æ¬Šå°ä»€éº¼çš„æ•æ„Ÿåº¦ï¼Ÿ", "a": ["è‚¡æ¯", "æ™‚é–“æµé€", "éš±å«æ³¢å‹•ç‡", "æ¨™çš„åƒ¹æ ¼"], correct: 2 },
                    { q: "ç•¶å¸‚å ´ç™¼ç”Ÿææ…Œå¤§è·Œï¼Œéš±å«æ³¢å‹•ç‡æ€¥å‡ï¼Œæ­¤æ™‚ Vega æœƒå°å“ªä¸€æ–¹æœ€æœ‰åˆ©ï¼Ÿ", "a": ["è²·æ–¹", "è³£æ–¹", "çµç®—æ‰€", "åˆ¸å•†"], correct: 0 },
                    { q: "å»ºç«‹ä¸€å€‹ã€ŒDelta ä¸­æ€§ã€çš„éƒ¨ä½ï¼Œä»£è¡¨ä½ çš„ç­–ç•¥æœ€ä¸é—œå¿ƒä»€éº¼å› ç´ ï¼Ÿ", "a": ["æ™‚é–“çš„æµé€", "æ³¢å‹•ç‡çš„æ”¹è®Š", "æ¨™çš„ç‰©æœªä¾†çš„æ¼²è·Œæ–¹å‘", "å±¥ç´„åƒ¹çš„é¸æ“‡"], correct: 2 },
                    { q: "å“ªä¸€å€‹å¸Œè‡˜å­—æ¯å¯ä»¥ç”¨ä¾†è©•ä¼°é¸æ“‡æ¬Šåˆ°æœŸæ™‚æˆç‚ºåƒ¹å…§çš„æ©Ÿç‡ï¼Ÿ", "a": ["Gamma", "Theta", "Vega", "Delta"], correct: 3 },
                    { q: "è²·é€²è²·æ¬Šèˆ‡è²·é€²è³£æ¬Šçš„ Gamma å€¼çš†ç‚ºï¼Ÿ", "a": ["è² å€¼", "é›¶", "æ­£å€¼", "éš¨æ©Ÿ"], correct: 2 },
                    { q: "é¸æ“‡æ¬Šåˆ°æœŸå‰å¹¾å¤©ï¼Œåƒ¹å¹³é¸æ“‡æ¬Šçš„å“ªä¸€å€‹å¸Œè‡˜å­—æ¯è®ŠåŒ–æœ€åŠ‡çƒˆï¼Ÿ", "a": ["Delta", "Gamma", "Theta", "Vega"], correct: 1 }
                ],
                5: [
                    { q: "ã€Œè²·é€²è²·æ¬Š (Long Call)ã€é©åˆåœ¨ä»€éº¼æ¨£çš„å¸‚å ´é æœŸä¸‹ä½¿ç”¨ï¼Ÿ", "a": ["é æœŸè¡Œæƒ…ç›¤æ•´", "é æœŸè¡Œæƒ…å¤§è·Œ", "é æœŸè¡Œæƒ…å³å°‡å¤§æ¼²", "é æœŸæ³¢å‹•ç‡ä¸‹é™"], correct: 2 },
                    { q: "ã€Œè³£å‡ºè³£æ¬Š (Short Put)ã€çš„æœ€å¤§ç²åˆ©æ˜¯å¤šå°‘ï¼Ÿ", "a": ["ç„¡é™", "æ¨™çš„ç‰©è·Œåˆ°0", "æ”¶åˆ°çš„å…¨éƒ¨æ¬Šåˆ©é‡‘", "ä¿è­‰é‡‘çš„ä¸€åŠ"], correct: 2 },
                    { q: "é æœŸå¸‚å ´æœƒæœ‰åŠ‡çƒˆæ³¢å‹•ï¼Œä½†ä¸çŸ¥é“æ–¹å‘ï¼Œé©åˆä½¿ç”¨ä»€éº¼ç­–ç•¥ï¼Ÿ", "a": ["é›™è²·çµ„åˆ (Long Strangle/Straddle)", "é›™è³£çµ„åˆ (Short Strangle/Straddle)", "å¤šé ­åƒ¹å·®", "ç©ºé ­åƒ¹å·®"], correct: 0 },
                    { q: "é æœŸå¸‚å ´å°‡é€²å…¥ç‹¹å¹…ç›¤æ•´ï¼Œé©åˆä½¿ç”¨ä»€éº¼ç­–ç•¥ï¼Ÿ", "a": ["é›™è²·çµ„åˆ", "é›™è³£çµ„åˆ (Short Strangle)", "è²·é€²è²·æ¬Š", "è²·é€²è³£æ¬Š"], correct: 1 },
                    { q: "ã€Œå¤šé ­åƒ¹å·® (Bull Spread)ã€çš„ä¸»è¦å„ªå‹¢æ˜¯ä»€éº¼ï¼Ÿ", "a": ["ç²åˆ©ç„¡é™å¤§", "é–å®šæœ€å¤§è™§æèˆ‡æœ€å¤§ç²åˆ©ï¼Œé™ä½è³‡é‡‘æˆæœ¬", "å®Œå…¨ä¸éœ€è¦ä¿è­‰é‡‘", "å¯ä»¥è¦é¿æ‰€æœ‰æ³¢å‹•ç‡é¢¨éšª"], correct: 1 },
                    { q: "éµç¦¿é·¹çµ„åˆ (Iron Condor) æ˜¯ç”±ä»€éº¼ç­–ç•¥çµ„åˆè€Œæˆçš„ï¼Ÿ", "a": ["å–®ç´”è²·é€² Call èˆ‡ Put", "è³£å‡ºä¸€å€‹å‹’å¼çµ„åˆï¼Œä¸¦åœ¨æ›´åƒ¹å¤–è²·é€²ä¸€å€‹å‹’å¼åšä¿è­·", "è³£å‡ºå››å€‹ç›¸åŒå±¥ç´„åƒ¹çš„ Call", "è²·é€²å…©å€‹å¤šé ­åƒ¹å·®"], correct: 1 },
                    { q: "ã€Œéµè´è¶çµ„åˆ (Iron Butterfly)ã€çš„ç²åˆ©ç”œèœœé»åœ¨å“ªè£¡ï¼Ÿ", "a": ["å¤§æ¼²æ™‚", "å¤§è·Œæ™‚", "çµç®—åœ¨ä¸­é–“å…©å€‹ç›¸åŒçš„å±¥ç´„åƒ¹ä¸Š", "éš±å«æ³¢å‹•ç‡æœ€é«˜æ™‚"], correct: 2 },
                    { q: "é æœŸæœªä¾†è‚¡åƒ¹æœƒæœ‰å°å¹…ä¸‹è·Œï¼Œä½†ä¸‹è·Œç©ºé–“æœ‰é™ï¼Œæœ€é©åˆä»€éº¼ç­–ç•¥ï¼Ÿ", "a": ["è²·é€²è²·æ¬Š", "è³£å‡ºè³£æ¬Š", "å¤šé ­åƒ¹å·®", "ç©ºé ­åƒ¹å·® (Bear Spread)"], correct: 3 },
                    { q: "é›™è²·çµ„åˆ (Long Strangle) æœ€å¤§çš„è™§æç‚ºï¼Ÿ", "a": ["ç„¡é™å¤§", "å…©é‚Šæ”¯ä»˜çš„æ¬Šåˆ©é‡‘ç¸½å’Œ", "å–®é‚Šçš„ä¿è­‰é‡‘", "æ¨™çš„è³‡ç”¢çš„åƒ¹æ ¼"], correct: 1 },
                    { q: "é›™è³£çµ„åˆ (Short Strangle) æœ€å¤§çš„é¢¨éšªåœ¨æ–¼ï¼Ÿ", "a": ["æ™‚é–“åƒ¹å€¼æµå¤±å¤ªå¿«", "ä»»ä¸€æ–¹å‘ç™¼ç”Ÿæ¥µç«¯å¤§æ¼²æˆ–å¤§è·Œ", "æ³¢å‹•ç‡ä¸‹é™", "çµç®—åœ¨å…©å€‹å±¥ç´„åƒ¹ä¸­é–“"], correct: 1 }
                ],
                6: [
                    { q: "æ­å¼é¸æ“‡æ¬Šèˆ‡ç¾å¼é¸æ“‡æ¬Šæœ€å¤§çš„å·®ç•°ç‚ºä½•ï¼Ÿ", "a": ["æ­å¼åªèƒ½åœ¨æ­æ´²äº¤æ˜“", "æ­å¼åªèƒ½åœ¨åˆ°æœŸæ—¥å±¥ç´„ï¼Œç¾å¼å¯åœ¨åˆ°æœŸå‰ä»»ä¸€å¤©å±¥ç´„", "ç¾å¼é¸æ“‡æ¬Šæ²’æœ‰åˆ°æœŸæ—¥", "ç¾å¼åªèƒ½ç¾é‡‘çµç®—"], correct: 1 },
                    { q: "å°ç£æœŸäº¤æ‰€çš„å°æŒ‡é¸æ“‡æ¬Šå±¬æ–¼å“ªä¸€ç¨®é¸æ“‡æ¬Šï¼Ÿ", "a": ["ç¾å¼é¸æ“‡æ¬Š", "æ­å¼é¸æ“‡æ¬Š", "äºå¼é¸æ“‡æ¬Š", "ç™¾æ…•é”é¸æ“‡æ¬Š"], correct: 1 },
                    { q: "æ–°æ‰‹è³£æ–¹æœ€å®¹æ˜“è¸©åˆ°çš„åœ°é›·æ˜¯ä»€éº¼ï¼Ÿ", "a": ["è²·é€²å¤ªå¤šçš„ Call", "é‡å€‰è³£å‡ºæ·±åº¦åƒ¹å¤–çš„é¸æ“‡æ¬Šï¼Œé‡é»‘å¤©éµé­æ–·é ­", "ææ—©å¹³å€‰", "åšå¤šé ­åƒ¹å·®"], correct: 1 },
                    { q: "é¸æ“‡æ¬Šä¿è­‰é‡‘çš„è¨ˆç®—æœƒå—åˆ°ä»€éº¼å› ç´ å½±éŸ¿è€Œå‹•æ…‹èª¿æ•´ï¼Ÿ", "a": ["é–‹ç›¤æ™‚é–“", "è²·æ–¹çš„æ„é¡˜", "æ¨™çš„æŒ‡æ•¸åƒ¹æ ¼èˆ‡æ³¢å‹•ç‡", "æœŸè²¨å•†çš„å¿ƒæƒ…"], correct: 2 },
                    { q: "é¢å°è™§æéƒ¨ä½ï¼Œæ–°æ‰‹è²·æ–¹å¸¸çŠ¯çš„éŒ¯èª¤æ˜¯ä»€éº¼ï¼Ÿ", "a": ["æ¨ä¸å¾—åœæï¼Œå‡¹å–®ç›´åˆ°æ™‚é–“åƒ¹å€¼æ­¸é›¶", "ææ—©ç²åˆ©äº†çµ", "è½‰ç‚ºè³£æ–¹", "è²·å…¥å¤ªå¤šè‚¡ç¥¨"], correct: 0 },
                    { q: "ç‚ºä»€éº¼æ–°æ‰‹ä¸å»ºè­°åœ¨é‡å¤§ç¶“æ¿Ÿæ•¸æ“šå…¬ä½ˆå‰åšã€Œé›™è³£ã€ï¼Ÿ", "a": ["å› ç‚ºæ‰‹çºŒè²»æœƒè®Šè²´", "å› ç‚ºæ²’æœ‰äººæœƒè²·", "å› ç‚ºæ³¢å‹•ç‡å¯èƒ½ç¬é–“é£†é«˜å°è‡´ä¿è­‰é‡‘ä¸è¶³è¢«é›™æ®º", "å› ç‚ºæœƒè¢«æš«åœäº¤æ˜“"], correct: 2 },
                    { q: "æ–°æ‰‹å¿…çŸ¥çš„çŸ¥è­˜ä¸­ï¼Œå°æŒ‡é¸æ“‡æ¬Šçµç®—åƒ¹æ˜¯å¦‚ä½•è¨ˆç®—çš„ï¼Ÿ", "a": ["çµç®—æ—¥æœ€å¾Œä¸€ç­†æˆäº¤åƒ¹", "çµç®—æ—¥ç•¶å¤©æœ€é«˜åƒ¹", "ä¾æ“šçµç®—æ—¥æœ€å¾Œ30åˆ†é˜çš„æ¨™çš„æŒ‡æ•¸ç®—è¡“å¹³å‡åƒ¹", "éš”å¤©é–‹ç›¤åƒ¹"], correct: 2 },
                    { q: "æ–°æ‰‹å¸¸çŠ¯çš„é¸æ“‡æ¬Šåœ°é›·ä¹‹ä¸€ã€ŒæŠŠé¸æ“‡æ¬Šç•¶æ¨‚é€è²·ã€æ˜¯æŒ‡ï¼Ÿ", "a": ["åªè²·å°ç©é›»", "å¤§é‡è²·é€²æ¥µåº¦åƒ¹å¤–çš„é¸æ“‡æ¬Šè³­å¤§è¡Œæƒ…", "åªåšè³£æ–¹", "ä¸çœ‹ç›¤"], correct: 1 },
                    { q: "é¸æ“‡æ¬Šä¿è­‰é‡‘è‹¥ä½æ–¼ã€Œç¶­æŒä¿è­‰é‡‘ã€ï¼Œæœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ", "a": ["è‡ªå‹•å±•å»¶åˆ°æœŸæ—¥", "æ”¶åˆ°è¿½ç¹³é€šçŸ¥(Margin Call)æˆ–è¢«å¼·åˆ¶å¹³å€‰", "ç²åˆ©åŠ å€", "é€€é‚„éƒ¨åˆ†æ¬Šåˆ©é‡‘"], correct: 1 },
                    { q: "æ–°æ‰‹è³£æ–¹å¿…é ˆå…·å‚™çš„æœ€é‡è¦è§€å¿µæ˜¯ï¼Ÿ", "a": ["å‹ç‡é«˜æ‰€ä»¥å¯ä»¥é‡å€‰", "åš´æ ¼çš„è³‡é‡‘æ§ç®¡èˆ‡åœæç´€å¾‹", "æ°¸é ä¸è¦å¹³å€‰", "åªè¦è³£å¾ˆé çš„åƒ¹å¤–å°±çµ•å°å®‰å…¨"], correct: 1 }
                ],
                7: [
                    { q: "ç¨‹å¼é‡åŒ–äº¤æ˜“åœ¨é¸æ“‡æ¬Šæ“ä½œä¸Šçš„æœ€å¤§å„ªå‹¢æ˜¯ä»€éº¼ï¼Ÿ", "a": ["ä¿è­‰100%ç²åˆ©", "æ‰‹çºŒè²»å…¨å…", "æ’é™¤äººç‚ºæƒ…ç·’å¹²æ“¾ï¼Œåš´æ ¼åŸ·è¡Œç´€å¾‹", "èƒ½é çŸ¥æœªä¾†æœ€é«˜é»"], correct: 2 },
                    { q: "Joption ç³»çµ±ä¸­ï¼Œåˆ¤æ–·æ˜¯å¦é€²å ´çš„ä¾æ“šé€šå¸¸ä¾†è‡ªæ–¼ï¼Ÿ", "a": ["é›»è¦–åå˜´çš„åˆ†æ", "å€‹äººçš„ç›´è¦º", "æ­·å²æ•¸æ“šå›æ¸¬èˆ‡çµ±è¨ˆæœŸæœ›å€¼", "éš¨æ©Ÿé¸å–"], correct: 2 },
                    { q: "åœ¨è‡ªå‹•åŒ–äº¤æ˜“ä¸­ï¼Œè¨­å®šã€Œåœæé»ã€çš„æ ¸å¿ƒç›®çš„æ˜¯ï¼Ÿ", "a": ["ç‚ºäº†è®“åˆ¸å•†è³ºæ‰‹çºŒè²»", "æ§åˆ¶æœ€å¤§é¢¨éšªï¼Œä¿ä½æœ¬é‡‘", "è®“å‹ç‡è®Šé«˜", "ææ—©ä¼‘æ¯"], correct: 1 },
                    { q: "é‡åŒ–äº¤æ˜“ç­–ç•¥ä¸­å¸¸æåˆ°çš„ã€Œå‹ç‡ã€èˆ‡ã€Œç›ˆè™§æ¯”ã€ï¼Œä½•è€…è¼ƒé‡è¦ï¼Ÿ", "a": ["åªæœ‰å‹ç‡é‡è¦", "åªæœ‰ç›ˆè™§æ¯”é‡è¦", "å…©è€…é ˆç¶œåˆè©•ä¼°ï¼Œæ§‹æˆæ­£æœŸæœ›å€¼ç³»çµ±", "å…©è€…éƒ½ä¸é‡è¦"], correct: 2 },
                    { q: "ç‚ºä»€éº¼é¸æ“‡æ¬Šé©åˆç™¼å±•é‡åŒ–ç­–ç•¥ï¼Ÿ", "a": ["å› ç‚ºæ‰‹çºŒè²»æœ€è²´", "å› ç‚ºå…¶å…·æœ‰æ˜ç¢ºçš„åˆ°æœŸæ—¥èˆ‡å¤šç¶­åº¦çš„æ•¸å­¸å®šåƒ¹æ¨¡å‹", "å› ç‚ºèµ°å‹¢å®Œå…¨éš¨æ©Ÿ", "å› ç‚ºåªæœ‰å°‘æ•¸äººç©"], correct: 1 },
                    { q: "ä½¿ç”¨é‡åŒ–ç³»çµ±é€²è¡Œè³£æ–¹ç­–ç•¥æ™‚ï¼Œæœ€éœ€è¦ç›£æ§çš„é¢¨éšªæŒ‡æ¨™æ˜¯ï¼Ÿ", "a": ["ç•¶å¤©çš„å¤©æ°£", "ä¿è­‰é‡‘ç¶­æŒç‡èˆ‡æ•´é«”éƒ¨ä½ Delta æ›éšª", "è²·æ¬Šçš„æˆäº¤é‡", "æ–°èé ­æ¢"], correct: 1 },
                    { q: "å¥½çš„é‡åŒ–ç³»çµ±åœ¨é¢å°æ¥µç«¯è¡Œæƒ…(é»‘å¤©éµ)æ™‚ï¼Œæ‡‰è©²å…·å‚™ä»€éº¼æ©Ÿåˆ¶ï¼Ÿ", "a": ["é—œæ©Ÿæ‹”æ’é ­", "è‡ªå‹•é¿éšªæˆ–é™ä½æ›éšªéƒ¨ä½çš„æ©Ÿåˆ¶", "åŠ ç¢¼æ”¤å¹³", "åˆªé™¤æ­·å²è³‡æ–™"], correct: 1 },
                    { q: "é‡åŒ–äº¤æ˜“ç³»çµ±ä¸­æœ€å¸¸è¦‹çš„é¢¨éšªæ§åˆ¶æ‰‹æ®µæ˜¯ï¼Ÿ", "a": ["ç„¡é™åŠ ç¢¼", "éƒ¨ä½è¦æ¨¡é™åˆ¶èˆ‡å‹•æ…‹åœæ", "åªåšå–®ä¸€å±¥ç´„åƒ¹", "æ†‘æ„Ÿè¦ºå¹³å€‰"], correct: 1 },
                    { q: "Joption ç³»çµ±å¦‚ä½•é¿å…äººç‚ºåˆ¤æ–·çš„ç›²é»ï¼Ÿ", "a": ["ä¾é å®¢è§€çš„çµ±è¨ˆæ•¸æ“šèˆ‡æŒ‡æ¨™ç™¼å‡ºé€²å‡ºå ´è¨Šè™Ÿ", "è·Ÿéš¨å¸‚å ´å¤šæ•¸äººçš„æ„è¦‹", "åªåœ¨ç‰¹å®šç¯€æ—¥äº¤æ˜“", "ä¸çœ‹ä»»ä½•æ•¸æ“š"], correct: 0 },
                    { q: "è©•ä¼°ä¸€å€‹é‡åŒ–ç­–ç•¥å¥½å£çš„é—œéµæŒ‡æ¨™ã€Œä¸åŒ…æ‹¬ã€å“ªä¸€é …ï¼Ÿ", "a": ["æœ€å¤§äº¤æ˜“å›æ’¤ (MDD)", "å¤æ™®å€¼ (Sharpe Ratio)", "å¹´åŒ–å ±é…¬ç‡", "ä»‹é¢è¨­è¨ˆæ˜¯å¦è¯éº—"], correct: 3 }
                ]
            };

            // å®‰å…¨åˆå§‹åŒ– Firebase
            useEffect(() => {
                if (window.FirebaseSDK) {
                    initAuthFlow();
                } else {
                    const handleReady = () => initAuthFlow();
                    window.addEventListener('firebase-ready', handleReady);
                    return () => window.removeEventListener('firebase-ready', handleReady);
                }
            }, []);

            const initAuthFlow = async () => {
                setIsFirebaseReady(true);
                try {
                    await window.FirebaseSDK.signInAnonymously(window.FirebaseSDK.auth);
                } catch (e) {
                    console.error("Firebase æˆæ¬Šå¤±æ•—:", e);
                    setAuthError("ç„¡æ³•å–å¾—é€£ç·šæ¬Šé™ï¼Œè«‹ç¢ºèª Firebase è¨­å®šï¼ˆæ˜¯å¦é–‹å•ŸåŒ¿åç™»å…¥ï¼‰ã€‚");
                } finally {
                    setIsLoadingApp(false);
                }
            };

            const handleEmailLogin = async (e) => {
                e.preventDefault();
                if (!isFirebaseReady) {
                    setAuthError("ç³»çµ±å°šæœªå°±ç·’ï¼Œè«‹ç¨å€™ã€‚");
                    return;
                }
                if (!playerEmail.trim() || !playerEmail.includes('@')) {
                    setAuthError("è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­ä¿¡ç®±");
                    return;
                }
                if (!playerName.trim()) {
                    setAuthError("è«‹è¼¸å…¥æ‚¨çš„å§“å");
                    return;
                }

                setAuthError('');
                setIsLoadingProgress(true);

                try {
                    const { doc, getDoc, setDoc, db } = window.FirebaseSDK;
                    const safeEmail = playerEmail.toLowerCase().trim();
                    const docRef = doc(db, 'userProgress', safeEmail);
                    
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        setChapterScores(data.scores || { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0 });
                        setPlayerName(data.playerName || playerName);
                    } else {
                        const initialScores = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0 };
                        await setDoc(docRef, {
                            playerName: playerName,
                            scores: initialScores,
                            createdAt: Date.now(),
                            updatedAt: Date.now()
                        });
                        setChapterScores(initialScores);
                    }
                    setView('home');
                } catch (error) {
                    console.error("Login Error:", error);
                    setAuthError("è³‡æ–™åº«é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¢ºèª Firebase å·²é–‹å•Ÿã€ŒTest Modeã€èˆ‡ã€ŒAnonymous Authã€ã€‚");
                } finally {
                    setIsLoadingProgress(false);
                }
            };

            const handleLogout = () => {
                setPlayerEmail('');
                setPlayerName('');
                setChapterScores({ 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0 });
                setView('auth');
            };

            // ğŸš€ ç›´æ¥è®€å–å…§å»ºçš„ JSON é¡Œåº« (ç„¡ CORS å•é¡Œ)
            const startQuiz = (chapIdx) => {
                if (chapIdx > 1 && (chapterScores[chapIdx - 1] || 0) < 80) {
                    alert(`éœ€å…ˆåœ¨ç¬¬ ${chapIdx - 1} ç« å–å¾— 80 åˆ†ä»¥ä¸Š`);
                    return;
                }
                
                const qBank = ALL_QUESTIONS[chapIdx] || ALL_QUESTIONS[1];
                
                // ğŸš€ æ¸¬è©¦æ¨¡å¼ï¼šæ¯ä¸€ç¯€éš¨æ©ŸæŠ½ 1 æå‡ºä¾†æ¸¬è©¦é—–é—œ (æœªä¾†è‹¥è¦ 10 é¡Œé€šé—œï¼ŒæŠŠ 1 æ”¹æˆ 10 å³å¯)
                const numQuestions = 1; 
                setCurrentQuestions([...qBank].sort(() => 0.5 - Math.random()).slice(0, numQuestions));
                
                setCurrentChapterIndex(chapIdx);
                setCurrentIndex(0); 
                setScore(0); 
                setFailedThisQuestion(false);
                setView('quiz');
            };

            const handleAnswer = async (idx) => {
                const isCorrect = idx === currentQuestions[currentIndex].correct;
                
                if (isCorrect) {
                    setQuizFeedback('');
                    const ptsPerQ = 100 / currentQuestions.length;
                    const finalScoreForThisQuestion = failedThisQuestion ? 0 : ptsPerQ;
                    const newScore = score + finalScoreForThisQuestion;
                    setScore(newScore);

                    if (currentIndex < currentQuestions.length - 1) {
                        setCurrentIndex(currentIndex + 1);
                        setFailedThisQuestion(false);
                    } else {
                        const finalRoundedScore = Math.round(newScore);
                        setView('result');
                        
                        const newMaxScore = Math.max(chapterScores[currentChapterIndex] || 0, finalRoundedScore);
                        const updatedScores = { ...chapterScores, [currentChapterIndex]: newMaxScore };
                        setChapterScores(updatedScores);
                        
                        if (isFirebaseReady) {
                            try {
                                const { setDoc, doc, db } = window.FirebaseSDK;
                                const safeEmail = playerEmail.toLowerCase().trim();
                                await setDoc(doc(db, 'userProgress', safeEmail), {
                                    playerName: playerName,
                                    scores: updatedScores,
                                    updatedAt: Date.now()
                                }, { merge: true });
                            } catch (e) {
                                console.error("æ›´æ–°åˆ†æ•¸å¤±æ•—", e);
                            }
                        }
                    }
                } else {
                    setQuizFeedback('ç­”æ¡ˆéŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼');
                    setFeedbackKey(prev => prev + 1); 
                    setFailedThisQuestion(true);
                    if (typeof navigator !== 'undefined' && navigator.vibrate) navigator.vibrate(200);
                }
            };

            const saveAsImage = async () => {
                if (!certificateRef.current || isSaving) return;
                setIsSaving(true);
                try {
                    window.scrollTo(0, 0);
                    const canvas = await html2canvas(certificateRef.current, { scale: 3, useCORS: true, backgroundColor: "#fdf8f1" });
                    setSavedImageUrl(canvas.toDataURL("image/png", 1.0));
                } catch (err) { 
                    alert("ç”Ÿæˆå¤±æ•—ï¼Œå»ºè­°ä½¿ç”¨æ‰‹æ©Ÿæˆªåœ–åŠŸèƒ½å„²å­˜ã€‚"); 
                } finally { 
                    setIsSaving(false); 
                }
            };

            const getRankInfo = (s) => {
                if (s === 100) return { title: "æ¬Šåˆ©é‡‘ä¹‹ç¥", icon: "ğŸŸ£ğŸ‘‘", color: "text-purple-600", colorCode: "#9333ea" }; 
                if (s >= 80) return { title: "è³£æ–¹æ“ç›¤æ‰‹", icon: "ğŸ“Š", color: "text-stone-800", colorCode: "#292524" };
                if (s >= 60) return { title: "æ¬Šåˆ©é‡‘å­¸å¾’", icon: "ğŸ’°", color: "text-orange-800", colorCode: "#c2410c" };
                return { title: "é¸æ“‡æ¬Šå°ç™½", icon: "â“", color: "text-stone-400", colorCode: "#9ca3af" };
            };

            const fetchDetailedLeaderboard = async () => {
                if (!isFirebaseReady) return;
                setIsLoadingLeaderboard(true);
                setSelectedUser(null); 
                try {
                    const { collection, getDocs, db } = window.FirebaseSDK;
                    const querySnapshot = await getDocs(collection(db, 'userProgress'));
                    const boardData = [];

                    querySnapshot.forEach((docSnap) => {
                        const data = docSnap.data();
                        const scores = data.scores || {};
                        
                        let total = 0;
                        for (let i = 1; i <= 7; i++) { total += (scores[i] || 0); }
                        const average = Math.round(total / 7);

                        boardData.push({
                            name: data.playerName || 'åŒ¿åç©å®¶',
                            scores: scores,
                            average: average,
                            timestamp: data.updatedAt || 0,
                            date: new Date(data.updatedAt || Date.now()).toLocaleDateString('zh-TW')
                        });
                    });

                    setLeaderboard(boardData);
                } catch (e) {
                    console.error("è¼‰å…¥æ¦œå–®å¤±æ•—", e);
                } finally {
                    setIsLoadingLeaderboard(false);
                }
            };

            const sortedLeaderboard = useMemo(() => {
                const items = [...leaderboard];
                items.sort((a, b) => {
                    let valA = a[sortConfig.field];
                    let valB = b[sortConfig.field];
                    if (sortConfig.field === 'average' || sortConfig.field === 'timestamp') {
                        return sortConfig.direction === 'desc' ? valB - valA : valA - valB;
                    }
                    return sortConfig.direction === 'desc' ? String(valB).localeCompare(String(valA)) : String(valA).localeCompare(String(valB));
                });
                return items;
            }, [leaderboard, sortConfig]);

            const handleSort = (field) => {
                setSortConfig(prev => ({ field, direction: prev.field === field && prev.direction === 'desc' ? 'asc' : 'desc' }));
            };

            if (isLoadingApp) {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center bg-[#f4f4f2] gap-4">
                        <IconLoader className="w-12 h-12 text-stone-300" />
                        <p className="text-stone-400 font-bold tracking-widest animate-pulse">ç³»çµ±é€£ç·šä¸­...</p>
                    </div>
                );
            }

            return (
                <div className="min-h-screen p-4 md:p-8 flex flex-col items-center justify-center relative bg-[#f4f4f2]">
                    <div className="relative w-full max-w-5xl z-10 flex flex-col items-center">
                        
                        {/* ç™»å…¥ / è¨»å†Š */}
                        {view === 'auth' && (
                            <div className="bg-white p-6 md:p-10 rounded-[30px] md:rounded-[40px] shadow-2xl border-4 border-white text-center fade-in w-full max-w-lg mx-auto">
                                <img src="IPæ¨™ç±¤.jpg" alt="Logo" className="w-20 h-20 md:w-24 md:h-24 mx-auto border-4 border-white shadow-lg rounded-2xl md:rounded-3xl mb-6 md:mb-8" onError={e=>e.target.src='https://www.google.com/s2/favicons?domain=joption.tw&sz=128'} />
                                <h1 className="text-2xl md:text-3xl font-black text-stone-900 font-serif mb-2 md:mb-3">æ­å¤§é¸æ“‡æ¬Šæ•™å®¤</h1>
                                <p className="text-stone-400 text-xs md:text-sm mb-8 md:mb-10">è«‹è¼¸å…¥æ‚¨çš„å°ˆå±¬ Email ä½œç‚ºè·¨è£ç½®å­˜æª”æ†‘è­‰</p>

                                <form onSubmit={handleEmailLogin} className="space-y-4 md:space-y-5 text-left">
                                    <input type="text" placeholder="æ‚¨çš„å§“å (ç”¨æ–¼æ¦œå–®èˆ‡è­‰æ›¸)" className="w-full px-5 py-4 md:px-6 md:py-5 rounded-2xl md:rounded-3xl border-2 border-stone-50 focus:border-amber-400 focus:outline-none bg-stone-50/50 font-bold text-stone-700 text-base md:text-lg transition-colors" value={playerName} onChange={e=>setPlayerName(e.target.value)} disabled={!isFirebaseReady} required />
                                    <input type="email" placeholder="é›»å­ä¿¡ç®± (å­˜æª”å¸³è™Ÿ)" className="w-full px-5 py-4 md:px-6 md:py-5 rounded-2xl md:rounded-3xl border-2 border-stone-50 focus:border-amber-400 focus:outline-none bg-stone-50/50 font-bold text-stone-700 text-base md:text-lg transition-colors" value={playerEmail} onChange={e=>setPlayerEmail(e.target.value)} disabled={!isFirebaseReady} required />
                                    
                                    {authError && <p className="text-red-500 text-xs md:text-sm text-center font-bold">{authError}</p>}
                                    
                                    <button type="submit" disabled={isLoadingProgress || !isFirebaseReady} className="w-full bg-stone-900 text-white font-bold py-4 md:py-5 text-lg rounded-2xl md:rounded-[25px] shadow-xl hover:bg-black transition-all flex items-center justify-center gap-2 disabled:bg-stone-300 disabled:cursor-not-allowed disabled:shadow-none mt-2">
                                        {isLoadingProgress ? <IconLoader className="w-5 h-5 md:w-6 md:h-6" /> : 'ç™»å…¥ / è¼‰å…¥é€²åº¦'}
                                    </button>
                                </form>
                                <p className="mt-6 md:mt-8 text-stone-400 text-[10px] md:text-xs italic px-2 leading-relaxed">åªè¦ä½¿ç”¨ç›¸åŒçš„ Email ç™»å…¥ï¼Œå³å¯åœ¨é›»è…¦èˆ‡æ‰‹æ©Ÿé–“ç„¡ç¸«æ¥è»Œæ‚¨çš„æŒ‘æˆ°é€²åº¦ã€‚</p>
                            </div>
                        )}

                        {/* ç« ç¯€ä¸»ç•«é¢ */}
                        {view === 'home' && (
                            <div className="bg-white/90 backdrop-blur-md p-6 md:p-10 rounded-[30px] md:rounded-[40px] shadow-2xl border-4 border-white text-center fade-in w-full max-w-2xl mx-auto">
                                <div className="flex justify-between items-center mb-6 md:mb-8 border-b border-stone-100 pb-4 md:pb-6">
                                    <div className="text-left">
                                        <p className="text-[10px] md:text-xs text-stone-400 font-bold uppercase tracking-widest mb-1">æŒ‘æˆ°è€…</p>
                                        <h2 className="text-xl md:text-2xl font-black text-stone-800">{playerName}</h2>
                                        <p className="text-xs md:text-sm text-stone-400 mt-0.5">{playerEmail}</p>
                                    </div>
                                    <button onClick={handleLogout} className="text-xs md:text-sm bg-stone-50 px-4 py-2 md:py-3 rounded-xl md:rounded-2xl text-stone-500 hover:text-red-500 hover:bg-red-50 font-bold uppercase tracking-wider transition-all flex items-center gap-1.5 shadow-sm">
                                        <IconLogOut /> ç™»å‡º
                                    </button>
                                </div>

                                <div className="grid grid-cols-1 gap-3 md:gap-4 max-h-[50vh] md:max-h-[60vh] overflow-y-auto pr-2 scrollbar-hide mb-6 md:mb-8">
                                    {CHAPTERS.map((ch) => {
                                        const bestScore = chapterScores[ch.id] || 0;
                                        const isLocked = ch.id > 1 && (chapterScores[ch.id - 1] || 0) < 80;
                                        
                                        return (
                                            <button key={ch.id} onClick={() => startQuiz(ch.id)} disabled={isLocked} className={`w-full p-4 md:p-5 rounded-[20px] md:rounded-[25px] flex items-center justify-between transition-all border-2 group ${isLocked ? 'bg-stone-50 border-stone-100 text-stone-300 opacity-60 cursor-not-allowed' : 'bg-white border-stone-100 hover:border-amber-300 shadow-sm hover:shadow-md'}`}>
                                                <div className="flex items-center gap-4 md:gap-5">
                                                    <div className={`w-10 h-10 md:w-12 md:h-12 rounded-xl md:rounded-2xl flex items-center justify-center transition-colors ${isLocked ? 'bg-stone-100 text-stone-300' : 'bg-amber-50 text-amber-600 group-hover:bg-amber-100'}`}>
                                                        {ch.icon}
                                                    </div>
                                                    <div className="text-left">
                                                        <div className={`font-black text-sm md:text-base ${isLocked ? 'text-stone-400' : 'text-stone-800'}`}>{ch.title}</div>
                                                        <div className="text-[10px] md:text-xs font-bold opacity-50 uppercase tracking-widest mt-0.5">{ch.level}</div>
                                                    </div>
                                                </div>
                                                <div>
                                                    {isLocked ? (
                                                        <div className="text-[10px] md:text-xs flex items-center gap-1 font-bold px-2 py-1 md:px-3 md:py-1.5 bg-stone-100 rounded-lg"><IconLock />é–å®š</div>
                                                    ) : (
                                                        <span className={`text-xs md:text-sm font-black px-3 py-1.5 rounded-lg ${bestScore >= 80 ? 'text-green-600 bg-green-50' : (bestScore > 0 ? 'text-amber-600 bg-amber-50' : 'text-blue-600 bg-blue-50')}`}>
                                                            {bestScore > 0 ? `${bestScore} åˆ†` : 'é–‹å§‹æŒ‘æˆ°'}
                                                        </span>
                                                    )}
                                                </div>
                                            </button>
                                        );
                                    })}
                                </div>
                                <button onClick={() => { setView('leaderboard'); fetchDetailedLeaderboard(); }} className="w-full text-stone-600 bg-stone-100 font-bold py-4 md:py-5 rounded-[20px] md:rounded-[25px] text-sm md:text-base uppercase hover:bg-stone-200 transition-all flex items-center justify-center gap-2 shadow-sm">
                                    <IconTrophy /> è§€çœ‹å³æ™‚ç¸½æ¦œå–®
                                </button>
                            </div>
                        )}

                        {/* æ¸¬é©—ç•«é¢ */}
                        {view === 'quiz' && (
                             <div className="bg-white p-6 md:p-10 rounded-[30px] md:rounded-[40px] shadow-xl border-4 border-white fade-in min-h-[60vh] flex flex-col w-full max-w-2xl mx-auto">
                                 <div className="flex justify-between items-center mb-6 md:mb-10 text-stone-400 font-bold text-xs md:text-sm tracking-widest uppercase">
                                     <span className="truncate pr-4">{CHAPTERS.find(c => c.id === currentChapterIndex)?.title}</span>
                                     <span className="whitespace-nowrap">é€²åº¦ {currentIndex + 1} / {currentQuestions.length}</span>
                                 </div>
                                 <div className="w-full h-1.5 md:h-2 bg-stone-100 rounded-full mb-8 md:mb-12 overflow-hidden">
                                     <div className="h-full bg-amber-400 transition-all duration-500 ease-out" style={{ width: `${((currentIndex + 1) / currentQuestions.length) * 100}%` }}></div>
                                 </div>
                                 <h2 className="text-xl md:text-2xl font-black mb-8 md:mb-12 text-stone-800 text-left flex-1 leading-relaxed md:leading-loose">{currentQuestions[currentIndex]?.q}</h2>
                                 
                                 {quizFeedback && (
                                    <div key={feedbackKey} className="mb-6 p-4 bg-red-50 border border-red-100 rounded-2xl text-red-600 text-center font-bold text-sm md:text-base shake shadow-inner">
                                        {quizFeedback}
                                    </div>
                                 )}

                                 <div className="space-y-3 md:space-y-4">
                                     {currentQuestions[currentIndex]?.a.map((opt, i) => (
                                         <button key={i} onClick={() => handleAnswer(i)} className="w-full text-left p-4 md:p-6 border-2 border-stone-100 hover:border-amber-400 hover:bg-amber-50/50 rounded-2xl md:rounded-[25px] flex items-center transition-all group shadow-sm hover:shadow-md">
                                             <span className="flex-shrink-0 w-8 h-8 md:w-10 md:h-10 flex items-center justify-center bg-stone-100 group-hover:bg-amber-100 rounded-lg md:rounded-xl mr-4 md:mr-6 text-xs md:text-sm font-black transition-colors">{String.fromCharCode(65 + i)}</span>
                                             <span className="text-stone-700 font-bold text-sm md:text-base leading-relaxed">{opt}</span>
                                         </button>
                                     ))}
                                 </div>
                             </div>
                        )}

                        {/* æ¸¬é©—çµæœèˆ‡è­‰æ›¸ */}
                        {view === 'result' && (
                             <div className="space-y-6 md:space-y-8 fade-in flex flex-col items-center w-full max-w-3xl mx-auto">
                                 <div className="certificate-preview-scroll">
                                    <div className="certificate-outer" ref={certificateRef}>
                                        <div className="certificate-container">
                                            <div className="watermark-overlay"></div>
                                            <div className="certificate-inner-border">
                                                <div style={{ position: 'absolute', top: '50px', left: '60px' }}>
                                                    <img src="IPæ¨™ç±¤.jpg" alt="Logo" className="w-20 h-auto border border-stone-200 shadow-sm" onError={(e) => { e.target.onerror = null; e.target.src='https://www.google.com/s2/favicons?domain=joption.tw&sz=64'; }} />
                                                </div>
                                                <div style={{ marginTop: '40px' }} className="text-center">
                                                    <h1 className="text-6xl font-black text-stone-800 tracking-[0.25em] no-wrap">çµæ¥­è­‰æ›¸</h1>
                                                    <div style={{ marginTop: '75px' }}> 
                                                        <p className="text-stone-400 text-2xl tracking-[0.4em] font-bold uppercase no-wrap">{CHAPTERS.find(c => c.id === currentChapterIndex)?.title}</p>
                                                    </div>
                                                </div>
                                                <div style={{ marginBottom: '60px', marginTop: '20px' }}>
                                                    <p className="text-stone-50 text-3xl italic tracking-[0.2em] font-serif">èŒ²è­‰æ˜</p>
                                                </div>
                                                <div style={{ marginBottom: '15px' }} className="w-full text-center">
                                                    <h2 className="text-5xl font-black text-stone-900 no-wrap tracking-widest">{playerName}</h2>
                                                </div>
                                                <div style={{ marginBottom: '65px' }} className="flex items-center justify-center gap-36 w-full text-center">
                                                    <div className="text-center">
                                                        <span className="text-lg text-stone-300 font-bold block mb-3 uppercase tracking-[0.3em]">åˆ†æ•¸</span>
                                                        <span className="text-8xl font-black text-amber-800">{Math.round(score)}</span>
                                                    </div>
                                                    <div className="text-center">
                                                        <span className="text-lg text-stone-300 font-bold block mb-3 uppercase tracking-[0.3em]">æˆäºˆéšç´š</span>
                                                        <div className="flex flex-col items-center">
                                                            <span className="text-6xl mb-4">{getRankInfo(score).icon}</span>
                                                            <span className={`text-3xl font-black ${getRankInfo(score).color} no-wrap tracking-[0.2em]`}>{getRankInfo(score).title}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style={{ position: 'absolute', bottom: '15px', left: '30px', right: '30px' }} className="flex justify-between items-end">
                                                    <div className="text-left text-base text-stone-400 font-sans leading-relaxed uppercase tracking-tighter">
                                                        DATE: {new Date().toLocaleDateString('zh-TW')}<br/>
                                                        NO: JOPT-ID-C{currentChapterIndex}-{Math.floor(Date.now()/1000)}
                                                    </div>
                                                    <div className="relative flex items-center" style={{ transform: 'translate(-50px, -25px)' }}>
                                                        <span className="text-stone-900 text-4xl font-black italic">é™¢é•· æ­å¤§</span>
                                                        <div style={{ width: '110px', height: '110px', border: '5.5px solid rgba(220, 38, 38, 0.78)', borderRadius: '50%', position: 'absolute', top: '-55px', right: '-45px', display: 'flex', alignItems: 'center', justifyContent: 'center', transform: 'rotate(15deg)' }}>
                                                            <div className="text-red-600/95 font-black text-[27px] leading-[1.05] text-center font-sans">æ­å¤§<br/>é¸æ“‡æ¬Š</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                 </div>
                                 
                                 <div className="w-full max-w-lg space-y-3 px-4 md:px-0">
                                     <button onClick={saveAsImage} disabled={isSaving} className="w-full bg-[#8baeb2] text-white py-4 md:py-5 rounded-[20px] md:rounded-[25px] font-black shadow-xl flex items-center justify-center gap-2 text-base md:text-lg hover:bg-[#7a9da1] transition-colors">
                                         {isSaving ? <IconLoader className="w-5 h-5 md:w-6 md:h-6 text-white" /> : <IconDownload />} ä¸‹è¼‰æœ¬ç« è­‰æ›¸
                                     </button>
                                     <button onClick={()=>setView('home')} className="w-full bg-white text-stone-500 border-2 border-stone-100 py-4 md:py-5 rounded-[20px] md:rounded-[25px] font-bold text-sm md:text-base hover:bg-stone-50 transition-colors shadow-sm">è¿”å›ç« ç¯€åˆ—è¡¨</button>
                                 </div>
                             </div>
                        )}

                        {/* æ’è¡Œæ¦œ / æˆç¸¾è©•é‡å„€è¡¨æ¿ */}
                        {view === 'leaderboard' && (
                            <div className="bg-white p-5 md:p-8 rounded-[30px] md:rounded-[40px] shadow-2xl border-4 border-white fade-in w-full max-w-4xl flex flex-col min-h-[85vh] md:min-h-[75vh]">
                                
                                {selectedUser ? (
                                    <div className="flex flex-col h-full fade-in">
                                        <div className="flex justify-between items-center mb-6 pb-4 border-b border-stone-100">
                                            <button onClick={() => setSelectedUser(null)} className="p-2 px-3 md:px-4 -ml-2 text-stone-600 bg-stone-100 hover:bg-stone-200 rounded-xl transition-colors flex items-center gap-1 font-bold text-xs md:text-sm shadow-sm">
                                                <IconChevronLeft /> è¿”å›æ¦œå–®
                                            </button>
                                            <h2 className="text-lg md:text-xl font-black text-stone-800 tracking-widest font-serif">é¸æ“‡æ¬Šç‹è€…æ¦®è€€</h2>
                                        </div>

                                        <div className="flex flex-col lg:flex-row gap-8 items-center flex-1">
                                            <div className="w-full lg:w-1/2 space-y-6">
                                                <div className="flex items-center gap-4 bg-stone-50 p-4 md:p-5 rounded-3xl border border-stone-100">
                                                    <div className="w-14 h-14 md:w-16 md:h-16 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center text-3xl md:text-4xl shadow-inner flex-shrink-0">
                                                        {getRankInfo(selectedUser.average).icon}
                                                    </div>
                                                    <div className="overflow-hidden">
                                                        <div className="font-black text-lg md:text-xl text-stone-800 truncate">{selectedUser.name}</div>
                                                        <div className={`text-xs md:text-sm font-bold uppercase tracking-widest mt-1 ${getRankInfo(selectedUser.average).color} truncate`}>{getRankInfo(selectedUser.average).title}</div>
                                                    </div>
                                                    <div className="ml-auto text-right flex-shrink-0 pl-2">
                                                        <div className="text-[10px] md:text-xs text-stone-400 font-bold uppercase tracking-wider">Average</div>
                                                        <div className="text-3xl md:text-4xl font-black text-stone-900">{selectedUser.average}</div>
                                                    </div>
                                                </div>

                                                <div className="space-y-4 px-2">
                                                    <h3 className="text-sm md:text-base font-bold text-stone-800 mb-4 border-l-4 border-[#4f46e5] pl-3">æˆç¸¾è©•é‡è¼¸å…¥</h3>
                                                    {CHAPTERS.map(ch => {
                                                        const userScore = selectedUser.scores[ch.id] || 0;
                                                        return (
                                                            <div key={ch.id} className="relative group">
                                                                <div className="flex justify-between items-end mb-1.5">
                                                                    <span className="text-xs md:text-sm font-bold text-stone-600">{ch.title}</span>
                                                                    <span className={`text-xs md:text-sm font-black ${userScore >= 80 ? 'text-[#4f46e5]' : 'text-stone-400'}`}>{userScore} åˆ†</span>
                                                                </div>
                                                                <div className="w-full h-2 md:h-2.5 bg-stone-100 rounded-full overflow-hidden">
                                                                    <div 
                                                                        className={`h-full rounded-full transition-all duration-1000 ease-out ${userScore >= 80 ? 'bg-[#4f46e5]' : 'bg-stone-300'}`} 
                                                                        style={{ width: `${userScore}%` }}
                                                                    ></div>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>

                                            <div className="w-full lg:w-1/2 flex flex-col items-center justify-center p-6 md:p-8 bg-slate-50/50 rounded-[30px] md:rounded-[40px] border border-slate-100 min-h-[350px] md:min-h-[450px]">
                                                <h3 className="text-sm md:text-base font-bold text-stone-800 mb-6 md:mb-10 tracking-widest text-center">æˆ°åŠ›åˆ†æé›·é”åœ–</h3>
                                                <div className="w-full max-w-[280px] md:max-w-[340px] aspect-square relative flex items-center justify-center">
                                                    <RadarChart scores={selectedUser.scores} />
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div className="mt-8 pt-6 border-t border-stone-100 flex flex-col sm:flex-row gap-3 md:gap-4 w-full">
                                            <button onClick={() => setSelectedUser(null)} className="flex-1 bg-white text-stone-500 border-2 border-stone-100 font-bold py-4 md:py-5 rounded-[20px] md:rounded-[25px] hover:bg-stone-50 transition-all text-sm md:text-base shadow-sm">
                                                å›ç¸½æ¦œå–®
                                            </button>
                                            <button onClick={() => { setSelectedUser(null); setView('home'); }} className="flex-1 bg-stone-900 text-white font-bold py-4 md:py-5 rounded-[20px] md:rounded-[25px] shadow-lg hover:bg-black transition-all text-sm md:text-base">
                                                è¿”å›é¦–é ï¼Œç¹¼çºŒæŒ‘æˆ°
                                            </button>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="flex flex-col h-full fade-in">
                                        <div className="flex justify-between items-center mb-4 md:mb-6 border-b border-stone-100 pb-4 md:pb-5">
                                            <h2 className="text-xl md:text-2xl font-black text-stone-800 tracking-widest no-wrap font-serif">å…¨å€ç¸½æ¦œå–®</h2>
                                            <button onClick={() => setView('home')} className="p-2 md:p-3 bg-stone-50 rounded-xl text-stone-500 hover:text-stone-900 hover:bg-stone-100 transition-colors shadow-sm"><IconHome /></button>
                                        </div>
                                        
                                        <div className="flex px-4 md:px-6 py-2 md:py-3 text-stone-400 text-xs md:text-sm font-bold border-b border-stone-100 mb-3 md:mb-4 font-sans bg-stone-50/50 rounded-xl">
                                            <div className="w-[45%] text-left flex items-center gap-1 cursor-pointer hover:text-stone-600" onClick={() => handleSort('name')}>å§“å {sortConfig.field === 'name' && (sortConfig.direction === 'desc' ? <IconArrowDown /> : <IconArrowUp />)}</div>
                                            <div className="w-[25%] text-center flex items-center justify-center gap-1 cursor-pointer hover:text-stone-600" onClick={() => handleSort('average')}>åˆ†æ•¸ {sortConfig.field === 'average' && (sortConfig.direction === 'desc' ? <IconArrowDown /> : <IconArrowUp />)}</div>
                                            <div className="w-[30%] text-right flex items-center justify-end gap-1 cursor-pointer hover:text-stone-600" onClick={() => handleSort('timestamp')}>æ—¥æœŸ {sortConfig.field === 'timestamp' && (sortConfig.direction === 'desc' ? <IconArrowDown /> : <IconArrowUp />)}</div>
                                        </div>
                                        
                                        <div className="overflow-y-auto flex-1 space-y-2 md:space-y-3 pr-1 md:pr-2 scrollbar-hide text-left">
                                            {isLoadingLeaderboard ? (
                                                <div className="text-center py-32 text-stone-300 flex flex-col items-center gap-4"><IconLoader className="w-8 h-8 md:w-10 md:h-10 text-stone-300" /><p className="text-xs md:text-sm uppercase font-bold tracking-widest">å…¨å€æ•¸æ“šè®€å–ä¸­...</p></div>
                                            ) : sortedLeaderboard.length > 0 ? sortedLeaderboard.map((item, idx) => (
                                                <div key={idx} onClick={() => setSelectedUser(item)} className="player-row flex items-center justify-between p-4 md:p-5 bg-white rounded-[20px] md:rounded-[25px] border border-stone-100 mb-2 font-sans relative overflow-hidden group">
                                                    {sortConfig.field === 'average' && sortConfig.direction === 'desc' && idx < 3 && (
                                                        <div className="absolute left-0 top-0 bottom-0 w-1.5 md:w-2 bg-amber-400 rounded-l-full"></div>
                                                    )}
                                                    <div className="flex items-center gap-4 md:gap-5 w-[45%] pl-2 md:pl-3">
                                                        <span className={`flex-shrink-0 w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center font-black text-xs md:text-sm ${sortConfig.field === 'average' && sortConfig.direction === 'desc' && idx < 3 ? 'bg-amber-400 text-white shadow-md' : 'bg-stone-100 text-stone-400'}`}>
                                                            {sortConfig.field === 'average' && sortConfig.direction === 'desc' ? idx + 1 : 'â€¢'}
                                                        </span>
                                                        <div className="overflow-hidden">
                                                            <div className="font-bold text-stone-800 text-sm md:text-base truncate">{item.name}</div>
                                                            <div className="text-[10px] md:text-xs font-bold mt-0.5 truncate uppercase tracking-widest" style={{ color: getRankInfo(item.average).colorCode }}>{getRankInfo(item.average).title}</div>
                                                        </div>
                                                    </div>
                                                    <div className="w-[25%] text-center">
                                                        <span className="font-black text-stone-900 text-xl md:text-2xl">{item.average}</span>
                                                    </div>
                                                    <div className="w-[30%] text-right text-xs md:text-sm text-stone-400 tabular-nums font-bold">
                                                        {item.date}
                                                    </div>
                                                </div>
                                            )) : (
                                                <div className="text-center py-32 text-stone-400 flex flex-col items-center gap-4"><IconTrophy /><p className="text-sm font-bold">ç›®å‰å°šç„¡æŒ‘æˆ°ç´€éŒ„</p></div>
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {savedImageUrl && (
                            <div className="modal-backdrop" onClick={() => setSavedImageUrl(null)}>
                                <div className="bg-white p-6 md:p-8 rounded-[40px] max-w-sm w-full shadow-2xl relative" onClick={e => e.stopPropagation()}>
                                    <button onClick={() => setSavedImageUrl(null)} className="absolute -top-12 right-0 text-white flex items-center gap-1 font-bold">é—œé–‰ <IconX /></button>
                                    <div className="text-center mb-5">
                                        <p className="font-black text-amber-600 italic text-xl md:text-2xl tracking-widest mb-1">ğŸ‰ ç”ŸæˆæˆåŠŸï¼</p>
                                        <p className="text-sm font-bold mt-1 text-stone-600 underline underline-offset-4 decoration-stone-300">æ‰‹æ©Ÿç”¨æˆ¶è«‹ã€Œé•·æŒ‰ä¸‹æ–¹åœ–ç‰‡ã€å„²å­˜</p>
                                    </div>
                                    <div className="border-4 border-stone-50 rounded-[25px] overflow-hidden bg-white shadow-inner">
                                        <img src={savedImageUrl} alt="Certificate" className="saveable-image" />
                                    </div>
                                    <button onClick={() => setSavedImageUrl(null)} className="mt-6 w-full py-4 md:py-5 bg-stone-900 text-white rounded-[25px] font-black text-base md:text-lg shadow-lg">å®Œæˆå­˜æª”</button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>