<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>現代風格計算機</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
        }

        .calculator-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .btn:active {
            transform: scale(0.92);
            filter: brightness(1.2);
        }

        .btn-operator {
            background: rgba(249, 115, 22, 0.2);
            color: #fb923c;
        }

        .btn-operator:hover {
            background: rgba(249, 115, 22, 0.3);
        }

        .btn-action {
            background: rgba(255, 255, 255, 0.05);
            color: #e2e8f0;
        }

        .btn-action:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-equal {
            background: linear-gradient(to bottom right, #f97316, #ea580c);
            color: white;
        }

        /* 自定義滾動條以隱藏它，但仍保留滾動功能 */
        .display-screen {
            font-variant-numeric: tabular-nums;
            overflow-x: auto;
            scrollbar-width: none; /* Firefox */
        }

        .display-screen::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Edge */
        }
    </style>
</head>
<body>

    <div class="calculator-card p-6 rounded-3xl w-full max-w-[340px] m-4">
        <!-- 顯示區域 -->
        <div class="mb-6 text-right px-2">
            <div id="previous-operand" class="text-slate-500 text-sm h-6 mb-1 truncate"></div>
            <div id="current-operand" class="display-screen text-4xl font-light text-white truncate">0</div>
        </div>

        <!-- 按鈕網格 -->
        <div class="grid grid-cols-4 gap-3">
            <!-- 功能列 -->
            <button onclick="clearDisplay()" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-lg font-medium">AC</button>
            <button onclick="toggleSign()" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-lg font-medium">+/-</button>
            <button onclick="percentage()" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-lg font-medium">%</button>
            <button onclick="setOperator('÷')" class="btn btn-operator h-14 rounded-2xl flex items-center justify-center text-2xl font-medium">÷</button>

            <!-- 數字與乘法 -->
            <button onclick="appendNumber('7')" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-xl">7</button>
            <button onclick="appendNumber('8')" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-xl">8</button>
            <button onclick="appendNumber('9')" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-xl">9</button>
            <button onclick="setOperator('×')" class="btn btn-operator h-14 rounded-2xl flex items-center justify-center text-2xl font-medium">×</button>

            <!-- 數字與減法 -->
            <button onclick="appendNumber('4')" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-xl">4</button>
            <button onclick="appendNumber('5')" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-xl">5</button>
            <button onclick="appendNumber('6')" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-xl">6</button>
            <button onclick="setOperator('-')" class="btn btn-operator h-14 rounded-2xl flex items-center justify-center text-2xl font-medium">−</button>

            <!-- 數字與加法 -->
            <button onclick="appendNumber('1')" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-xl">1</button>
            <button onclick="appendNumber('2')" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-xl">2</button>
            <button onclick="appendNumber('3')" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-xl">3</button>
            <button onclick="setOperator('+')" class="btn btn-operator h-14 rounded-2xl flex items-center justify-center text-2xl font-medium">+</button>

            <!-- 底部列 -->
            <button onclick="appendNumber('0')" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-xl col-span-2">0</button>
            <button onclick="appendNumber('.')" class="btn btn-action h-14 rounded-2xl flex items-center justify-center text-xl">.</button>
            <button onclick="calculate()" class="btn btn-equal h-14 rounded-2xl flex items-center justify-center text-2xl font-medium">=</button>
        </div>
    </div>

    <script>
        let currentInput = '0';
        let previousInput = '';
        let operator = null;
        let shouldResetScreen = false;

        const currentDisplay = document.getElementById('current-operand');
        const previousDisplay = document.getElementById('previous-operand');

        // 更新顯示介面
        function updateDisplay() {
            currentDisplay.innerText = currentInput;
            if (operator != null) {
                previousDisplay.innerText = `${previousInput} ${operator}`;
            } else {
                previousDisplay.innerText = '';
            }
        }

        // 輸入數字
        function appendNumber(number) {
            if (currentInput === '0' || shouldResetScreen) {
                currentInput = number;
                shouldResetScreen = false;
            } else {
                if (number === '.' && currentInput.includes('.')) return;
                currentInput += number;
            }
            updateDisplay();
        }

        // 清除顯示
        function clearDisplay() {
            currentInput = '0';
            previousInput = '';
            operator = null;
            shouldResetScreen = false;
            updateDisplay();
        }

        // 正負號切換
        function toggleSign() {
            currentInput = (parseFloat(currentInput) * -1).toString();
            updateDisplay();
        }

        // 百分比
        function percentage() {
            currentInput = (parseFloat(currentInput) / 100).toString();
            updateDisplay();
        }

        // 設定運算子
        function setOperator(op) {
            if (operator !== null) calculate();
            previousInput = currentInput;
            operator = op;
            shouldResetScreen = true;
            updateDisplay();
        }

        // 執行計算
        function calculate() {
            if (operator === null || shouldResetScreen) return;
            
            let result;
            const prev = parseFloat(previousInput);
            const current = parseFloat(currentInput);

            if (isNaN(prev) || isNaN(current)) return;

            switch (operator) {
                case '+':
                    result = prev + current;
                    break;
                case '-':
                    result = prev - current;
                    break;
                case '×':
                    result = prev * current;
                    break;
                case '÷':
                    if (current === 0) {
                        // 使用自定義文字而非瀏覽器 alert 以維持美觀
                        currentInput = "錯誤";
                        updateDisplay();
                        setTimeout(clearDisplay, 1500);
                        return;
                    }
                    result = prev / current;
                    break;
                default:
                    return;
            }

            // 處理浮點數精度問題並轉為字串
            currentInput = (Math.round(result * 100000000) / 100000000).toString();
            operator = null;
            previousInput = '';
            shouldResetScreen = true;
            updateDisplay();
        }

        // 鍵盤支援
        window.addEventListener('keydown', (e) => {
            if (e.key >= '0' && e.key <= '9') appendNumber(e.key);
            if (e.key === '.') appendNumber('.');
            if (e.key === '=' || e.key === 'Enter') calculate();
            if (e.key === 'Backspace') {
                if (currentInput.length > 1 && !shouldResetScreen) {
                    currentInput = currentInput.slice(0, -1);
                } else {
                    currentInput = '0';
                }
                updateDisplay();
            }
            if (e.key === 'Escape') clearDisplay();
            if (e.key === '+') setOperator('+');
            if (e.key === '-') setOperator('-');
            if (e.key === '*') setOperator('×');
            if (e.key === '/') {
                e.preventDefault();
                setOperator('÷');
            }
        });
    </script>
</body>
</html>